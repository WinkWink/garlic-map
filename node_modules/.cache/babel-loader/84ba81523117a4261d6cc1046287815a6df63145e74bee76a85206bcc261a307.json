{"ast":null,"code":"'use strict';\n\nvar merge = require('../functions/merge');\nvar defaultsPure = require('../functions/defaultsPure');\nvar orderBy = require('../functions/orderBy');\nvar compact = require('../functions/compact');\nvar find = require('../functions/find');\nvar findIndex = require('../functions/findIndex');\nvar formatSort = require('../functions/formatSort');\nvar fv = require('../functions/escapeFacetValue');\nvar escapeFacetValue = fv.escapeFacetValue;\nvar unescapeFacetValue = fv.unescapeFacetValue;\nvar generateHierarchicalTree = require('./generate-hierarchical-tree');\n\n/**\n * @typedef SearchResults.Facet\n * @type {object}\n * @property {string} name name of the attribute in the record\n * @property {object} data the faceting data: value, number of entries\n * @property {object} stats undefined unless facet_stats is retrieved from algolia\n */\n\n/**\n * @typedef SearchResults.HierarchicalFacet\n * @type {object}\n * @property {string} name name of the current value given the hierarchical level, trimmed.\n * If root node, you get the facet name\n * @property {number} count number of objects matching this hierarchical value\n * @property {string} path the current hierarchical value full path\n * @property {boolean} isRefined `true` if the current value was refined, `false` otherwise\n * @property {HierarchicalFacet[]} data sub values for the current level\n */\n\n/**\n * @typedef SearchResults.FacetValue\n * @type {object}\n * @property {string} name the facet value itself\n * @property {number} count times this facet appears in the results\n * @property {boolean} isRefined is the facet currently selected\n * @property {boolean} isExcluded is the facet currently excluded (only for conjunctive facets)\n */\n\n/**\n * @typedef Refinement\n * @type {object}\n * @property {string} type the type of filter used:\n * `numeric`, `facet`, `exclude`, `disjunctive`, `hierarchical`\n * @property {string} attributeName name of the attribute used for filtering\n * @property {string} name the value of the filter\n * @property {number} numericValue the value as a number. Only for numeric filters.\n * @property {string} operator the operator used. Only for numeric filters.\n * @property {number} count the number of computed hits for this filter. Only on facets.\n * @property {boolean} exhaustive if the count is exhaustive\n */\n\n/**\n * @param {string[]} attributes\n */\nfunction getIndices(attributes) {\n  var indices = {};\n  attributes.forEach(function (val, idx) {\n    indices[val] = idx;\n  });\n  return indices;\n}\nfunction assignFacetStats(dest, facetStats, key) {\n  if (facetStats && facetStats[key]) {\n    dest.stats = facetStats[key];\n  }\n}\n\n/**\n * @typedef {Object} HierarchicalFacet\n * @property {string} name\n * @property {string[]} attributes\n */\n\n/**\n * @param {HierarchicalFacet[]} hierarchicalFacets\n * @param {string} hierarchicalAttributeName\n */\nfunction findMatchingHierarchicalFacetFromAttributeName(hierarchicalFacets, hierarchicalAttributeName) {\n  return find(hierarchicalFacets, function facetKeyMatchesAttribute(hierarchicalFacet) {\n    var facetNames = hierarchicalFacet.attributes || [];\n    return facetNames.indexOf(hierarchicalAttributeName) > -1;\n  });\n}\n\n/*eslint-disable */\n/**\n * Constructor for SearchResults\n * @class\n * @classdesc SearchResults contains the results of a query to Algolia using the\n * {@link AlgoliaSearchHelper}.\n * @param {SearchParameters} state state that led to the response\n * @param {array.<object>} results the results from algolia client\n * @example <caption>SearchResults of the first query in\n * <a href=\"http://demos.algolia.com/instant-search-demo\">the instant search demo</a></caption>\n{\n   \"hitsPerPage\": 10,\n   \"processingTimeMS\": 2,\n   \"facets\": [\n      {\n         \"name\": \"type\",\n         \"data\": {\n            \"HardGood\": 6627,\n            \"BlackTie\": 550,\n            \"Music\": 665,\n            \"Software\": 131,\n            \"Game\": 456,\n            \"Movie\": 1571\n         },\n         \"exhaustive\": false\n      },\n      {\n         \"exhaustive\": false,\n         \"data\": {\n            \"Free shipping\": 5507\n         },\n         \"name\": \"shipping\"\n      }\n  ],\n   \"hits\": [\n      {\n         \"thumbnailImage\": \"http://img.bbystatic.com/BestBuy_US/images/products/1688/1688832_54x108_s.gif\",\n         \"_highlightResult\": {\n            \"shortDescription\": {\n               \"matchLevel\": \"none\",\n               \"value\": \"Safeguard your PC, Mac, Android and iOS devices with comprehensive Internet protection\",\n               \"matchedWords\": []\n            },\n            \"category\": {\n               \"matchLevel\": \"none\",\n               \"value\": \"Computer Security Software\",\n               \"matchedWords\": []\n            },\n            \"manufacturer\": {\n               \"matchedWords\": [],\n               \"value\": \"Webroot\",\n               \"matchLevel\": \"none\"\n            },\n            \"name\": {\n               \"value\": \"Webroot SecureAnywhere Internet Security (3-Device) (1-Year Subscription) - Mac/Windows\",\n               \"matchedWords\": [],\n               \"matchLevel\": \"none\"\n            }\n         },\n         \"image\": \"http://img.bbystatic.com/BestBuy_US/images/products/1688/1688832_105x210_sc.jpg\",\n         \"shipping\": \"Free shipping\",\n         \"bestSellingRank\": 4,\n         \"shortDescription\": \"Safeguard your PC, Mac, Android and iOS devices with comprehensive Internet protection\",\n         \"url\": \"http://www.bestbuy.com/site/webroot-secureanywhere-internet-security-3-devi…d=1219060687969&skuId=1688832&cmp=RMX&ky=2d3GfEmNIzjA0vkzveHdZEBgpPCyMnLTJ\",\n         \"name\": \"Webroot SecureAnywhere Internet Security (3-Device) (1-Year Subscription) - Mac/Windows\",\n         \"category\": \"Computer Security Software\",\n         \"salePrice_range\": \"1 - 50\",\n         \"objectID\": \"1688832\",\n         \"type\": \"Software\",\n         \"customerReviewCount\": 5980,\n         \"salePrice\": 49.99,\n         \"manufacturer\": \"Webroot\"\n      },\n      ....\n  ],\n   \"nbHits\": 10000,\n   \"disjunctiveFacets\": [\n      {\n         \"exhaustive\": false,\n         \"data\": {\n            \"5\": 183,\n            \"12\": 112,\n            \"7\": 149,\n            ...\n         },\n         \"name\": \"customerReviewCount\",\n         \"stats\": {\n            \"max\": 7461,\n            \"avg\": 157.939,\n            \"min\": 1\n         }\n      },\n      {\n         \"data\": {\n            \"Printer Ink\": 142,\n            \"Wireless Speakers\": 60,\n            \"Point & Shoot Cameras\": 48,\n            ...\n         },\n         \"name\": \"category\",\n         \"exhaustive\": false\n      },\n      {\n         \"exhaustive\": false,\n         \"data\": {\n            \"> 5000\": 2,\n            \"1 - 50\": 6524,\n            \"501 - 2000\": 566,\n            \"201 - 500\": 1501,\n            \"101 - 200\": 1360,\n            \"2001 - 5000\": 47\n         },\n         \"name\": \"salePrice_range\"\n      },\n      {\n         \"data\": {\n            \"Dynex™\": 202,\n            \"Insignia™\": 230,\n            \"PNY\": 72,\n            ...\n         },\n         \"name\": \"manufacturer\",\n         \"exhaustive\": false\n      }\n  ],\n   \"query\": \"\",\n   \"nbPages\": 100,\n   \"page\": 0,\n   \"index\": \"bestbuy\"\n}\n **/\n/*eslint-enable */\nfunction SearchResults(state, results, options) {\n  var mainSubResponse = results[0];\n  this._rawResults = results;\n  var self = this;\n\n  // https://www.algolia.com/doc/api-reference/api-methods/search/#response\n  Object.keys(mainSubResponse).forEach(function (key) {\n    self[key] = mainSubResponse[key];\n  });\n\n  // Make every key of the result options reachable from the instance\n  Object.keys(options || {}).forEach(function (key) {\n    self[key] = options[key];\n  });\n\n  /**\n   * query used to generate the results\n   * @name query\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * The query as parsed by the engine given all the rules.\n   * @name parsedQuery\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * all the records that match the search parameters. Each record is\n   * augmented with a new attribute `_highlightResult`\n   * which is an object keyed by attribute and with the following properties:\n   *  - `value` : the value of the facet highlighted (html)\n   *  - `matchLevel`: full, partial or none depending on how the query terms match\n   * @name hits\n   * @member {object[]}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * index where the results come from\n   * @name index\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * number of hits per page requested\n   * @name hitsPerPage\n   * @member {number}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * total number of hits of this query on the index\n   * @name nbHits\n   * @member {number}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * total number of pages with respect to the number of hits per page and the total number of hits\n   * @name nbPages\n   * @member {number}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * current page\n   * @name page\n   * @member {number}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * The position if the position was guessed by IP.\n   * @name aroundLatLng\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   * @example \"48.8637,2.3615\",\n   */\n  /**\n   * The radius computed by Algolia.\n   * @name automaticRadius\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   * @example \"126792922\",\n   */\n  /**\n   * String identifying the server used to serve this request.\n   *\n   * getRankingInfo needs to be set to `true` for this to be returned\n   *\n   * @name serverUsed\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   * @example \"c7-use-2.algolia.net\",\n   */\n  /**\n   * Boolean that indicates if the computation of the counts did time out.\n   * @deprecated\n   * @name timeoutCounts\n   * @member {boolean}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * Boolean that indicates if the computation of the hits did time out.\n   * @deprecated\n   * @name timeoutHits\n   * @member {boolean}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * True if the counts of the facets is exhaustive\n   * @name exhaustiveFacetsCount\n   * @member {boolean}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * True if the number of hits is exhaustive\n   * @name exhaustiveNbHits\n   * @member {boolean}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * Contains the userData if they are set by a [query rule](https://www.algolia.com/doc/guides/query-rules/query-rules-overview/).\n   * @name userData\n   * @member {object[]}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * queryID is the unique identifier of the query used to generate the current search results.\n   * This value is only available if the `clickAnalytics` search parameter is set to `true`.\n   * @name queryID\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   */\n\n  /**\n   * sum of the processing time of all the queries\n   * @member {number}\n   */\n  this.processingTimeMS = results.reduce(function (sum, result) {\n    return result.processingTimeMS === undefined ? sum : sum + result.processingTimeMS;\n  }, 0);\n\n  /**\n   * disjunctive facets results\n   * @member {SearchResults.Facet[]}\n   */\n  this.disjunctiveFacets = [];\n  /**\n   * disjunctive facets results\n   * @member {SearchResults.HierarchicalFacet[]}\n   */\n  this.hierarchicalFacets = state.hierarchicalFacets.map(function initFutureTree() {\n    return [];\n  });\n  /**\n   * other facets results\n   * @member {SearchResults.Facet[]}\n   */\n  this.facets = [];\n  var disjunctiveFacets = state.getRefinedDisjunctiveFacets();\n  var facetsIndices = getIndices(state.facets);\n  var disjunctiveFacetsIndices = getIndices(state.disjunctiveFacets);\n  var nextDisjunctiveResult = 1;\n\n  // Since we send request only for disjunctive facets that have been refined,\n  // we get the facets information from the first, general, response.\n\n  var mainFacets = mainSubResponse.facets || {};\n  Object.keys(mainFacets).forEach(function (facetKey) {\n    var facetValueObject = mainFacets[facetKey];\n    var hierarchicalFacet = findMatchingHierarchicalFacetFromAttributeName(state.hierarchicalFacets, facetKey);\n    if (hierarchicalFacet) {\n      // Place the hierarchicalFacet data at the correct index depending on\n      // the attributes order that was defined at the helper initialization\n      var facetIndex = hierarchicalFacet.attributes.indexOf(facetKey);\n      var idxAttributeName = findIndex(state.hierarchicalFacets, function (f) {\n        return f.name === hierarchicalFacet.name;\n      });\n      self.hierarchicalFacets[idxAttributeName][facetIndex] = {\n        attribute: facetKey,\n        data: facetValueObject,\n        exhaustive: mainSubResponse.exhaustiveFacetsCount\n      };\n    } else {\n      var isFacetDisjunctive = state.disjunctiveFacets.indexOf(facetKey) !== -1;\n      var isFacetConjunctive = state.facets.indexOf(facetKey) !== -1;\n      var position;\n      if (isFacetDisjunctive) {\n        position = disjunctiveFacetsIndices[facetKey];\n        self.disjunctiveFacets[position] = {\n          name: facetKey,\n          data: facetValueObject,\n          exhaustive: mainSubResponse.exhaustiveFacetsCount\n        };\n        assignFacetStats(self.disjunctiveFacets[position], mainSubResponse.facets_stats, facetKey);\n      }\n      if (isFacetConjunctive) {\n        position = facetsIndices[facetKey];\n        self.facets[position] = {\n          name: facetKey,\n          data: facetValueObject,\n          exhaustive: mainSubResponse.exhaustiveFacetsCount\n        };\n        assignFacetStats(self.facets[position], mainSubResponse.facets_stats, facetKey);\n      }\n    }\n  });\n\n  // Make sure we do not keep holes within the hierarchical facets\n  this.hierarchicalFacets = compact(this.hierarchicalFacets);\n\n  // aggregate the refined disjunctive facets\n  disjunctiveFacets.forEach(function (disjunctiveFacet) {\n    var result = results[nextDisjunctiveResult];\n    var facets = result && result.facets ? result.facets : {};\n    var hierarchicalFacet = state.getHierarchicalFacetByName(disjunctiveFacet);\n\n    // There should be only item in facets.\n    Object.keys(facets).forEach(function (dfacet) {\n      var facetResults = facets[dfacet];\n      var position;\n      if (hierarchicalFacet) {\n        position = findIndex(state.hierarchicalFacets, function (f) {\n          return f.name === hierarchicalFacet.name;\n        });\n        var attributeIndex = findIndex(self.hierarchicalFacets[position], function (f) {\n          return f.attribute === dfacet;\n        });\n\n        // previous refinements and no results so not able to find it\n        if (attributeIndex === -1) {\n          return;\n        }\n        self.hierarchicalFacets[position][attributeIndex].data = merge({}, self.hierarchicalFacets[position][attributeIndex].data, facetResults);\n      } else {\n        position = disjunctiveFacetsIndices[dfacet];\n        var dataFromMainRequest = mainSubResponse.facets && mainSubResponse.facets[dfacet] || {};\n        self.disjunctiveFacets[position] = {\n          name: dfacet,\n          data: defaultsPure({}, facetResults, dataFromMainRequest),\n          exhaustive: result.exhaustiveFacetsCount\n        };\n        assignFacetStats(self.disjunctiveFacets[position], result.facets_stats, dfacet);\n        if (state.disjunctiveFacetsRefinements[dfacet]) {\n          state.disjunctiveFacetsRefinements[dfacet].forEach(function (refinementValue) {\n            // add the disjunctive refinements if it is no more retrieved\n            if (!self.disjunctiveFacets[position].data[refinementValue] && state.disjunctiveFacetsRefinements[dfacet].indexOf(unescapeFacetValue(refinementValue)) > -1) {\n              self.disjunctiveFacets[position].data[refinementValue] = 0;\n            }\n          });\n        }\n      }\n    });\n    nextDisjunctiveResult++;\n  });\n\n  // if we have some parent level values for hierarchical facets, merge them\n  state.getRefinedHierarchicalFacets().forEach(function (refinedFacet) {\n    var hierarchicalFacet = state.getHierarchicalFacetByName(refinedFacet);\n    var separator = state._getHierarchicalFacetSeparator(hierarchicalFacet);\n    var currentRefinement = state.getHierarchicalRefinement(refinedFacet);\n    // if we are already at a root refinement (or no refinement at all), there is no\n    // root level values request\n    if (currentRefinement.length === 0 || currentRefinement[0].split(separator).length < 2) {\n      return;\n    }\n    results.slice(nextDisjunctiveResult).forEach(function (result) {\n      var facets = result && result.facets ? result.facets : {};\n      Object.keys(facets).forEach(function (dfacet) {\n        var facetResults = facets[dfacet];\n        var position = findIndex(state.hierarchicalFacets, function (f) {\n          return f.name === hierarchicalFacet.name;\n        });\n        var attributeIndex = findIndex(self.hierarchicalFacets[position], function (f) {\n          return f.attribute === dfacet;\n        });\n\n        // previous refinements and no results so not able to find it\n        if (attributeIndex === -1) {\n          return;\n        }\n\n        // when we always get root levels, if the hits refinement is `beers > IPA` (count: 5),\n        // then the disjunctive values will be `beers` (count: 100),\n        // but we do not want to display\n        //   | beers (100)\n        //     > IPA (5)\n        // We want\n        //   | beers (5)\n        //     > IPA (5)\n        var defaultData = {};\n        if (currentRefinement.length > 0) {\n          var root = currentRefinement[0].split(separator)[0];\n          defaultData[root] = self.hierarchicalFacets[position][attributeIndex].data[root];\n        }\n        self.hierarchicalFacets[position][attributeIndex].data = defaultsPure(defaultData, facetResults, self.hierarchicalFacets[position][attributeIndex].data);\n      });\n      nextDisjunctiveResult++;\n    });\n  });\n\n  // add the excludes\n  Object.keys(state.facetsExcludes).forEach(function (facetName) {\n    var excludes = state.facetsExcludes[facetName];\n    var position = facetsIndices[facetName];\n    self.facets[position] = {\n      name: facetName,\n      data: mainSubResponse.facets[facetName],\n      exhaustive: mainSubResponse.exhaustiveFacetsCount\n    };\n    excludes.forEach(function (facetValue) {\n      self.facets[position] = self.facets[position] || {\n        name: facetName\n      };\n      self.facets[position].data = self.facets[position].data || {};\n      self.facets[position].data[facetValue] = 0;\n    });\n  });\n\n  /**\n   * @type {Array}\n   */\n  this.hierarchicalFacets = this.hierarchicalFacets.map(generateHierarchicalTree(state));\n\n  /**\n   * @type {Array}\n   */\n  this.facets = compact(this.facets);\n  /**\n   * @type {Array}\n   */\n  this.disjunctiveFacets = compact(this.disjunctiveFacets);\n  this._state = state;\n}\n\n/**\n * Get a facet object with its name\n * @deprecated\n * @param {string} name name of the faceted attribute\n * @return {SearchResults.Facet} the facet object\n */\nSearchResults.prototype.getFacetByName = function (name) {\n  function predicate(facet) {\n    return facet.name === name;\n  }\n  return find(this.facets, predicate) || find(this.disjunctiveFacets, predicate) || find(this.hierarchicalFacets, predicate);\n};\n\n/**\n * Get the facet values of a specified attribute from a SearchResults object.\n * @private\n * @param {SearchResults} results the search results to search in\n * @param {string} attribute name of the faceted attribute to search for\n * @return {array|object} facet values. For the hierarchical facets it is an object.\n */\nfunction extractNormalizedFacetValues(results, attribute) {\n  function predicate(facet) {\n    return facet.name === attribute;\n  }\n  if (results._state.isConjunctiveFacet(attribute)) {\n    var facet = find(results.facets, predicate);\n    if (!facet) return [];\n    return Object.keys(facet.data).map(function (name) {\n      var value = escapeFacetValue(name);\n      return {\n        name: name,\n        escapedValue: value,\n        count: facet.data[name],\n        isRefined: results._state.isFacetRefined(attribute, value),\n        isExcluded: results._state.isExcludeRefined(attribute, name)\n      };\n    });\n  } else if (results._state.isDisjunctiveFacet(attribute)) {\n    var disjunctiveFacet = find(results.disjunctiveFacets, predicate);\n    if (!disjunctiveFacet) return [];\n    return Object.keys(disjunctiveFacet.data).map(function (name) {\n      var value = escapeFacetValue(name);\n      return {\n        name: name,\n        escapedValue: value,\n        count: disjunctiveFacet.data[name],\n        isRefined: results._state.isDisjunctiveFacetRefined(attribute, value)\n      };\n    });\n  } else if (results._state.isHierarchicalFacet(attribute)) {\n    var hierarchicalFacetValues = find(results.hierarchicalFacets, predicate);\n    if (!hierarchicalFacetValues) return hierarchicalFacetValues;\n    var hierarchicalFacet = results._state.getHierarchicalFacetByName(attribute);\n    var currentRefinementSplit = unescapeFacetValue(results._state.getHierarchicalRefinement(attribute)[0] || '').split(results._state._getHierarchicalFacetSeparator(hierarchicalFacet));\n    currentRefinementSplit.unshift(attribute);\n    setIsRefined(hierarchicalFacetValues, currentRefinementSplit, 0);\n    return hierarchicalFacetValues;\n  }\n}\n\n/**\n * Set the isRefined of a hierarchical facet result based on the current state.\n * @param {SearchResults.HierarchicalFacet} item Hierarchical facet to fix\n * @param {string[]} currentRefinementSplit array of parts of the current hierarchical refinement\n * @param {number} depth recursion depth in the currentRefinement\n */\nfunction setIsRefined(item, currentRefinement, depth) {\n  item.isRefined = item.name === currentRefinement[depth];\n  if (item.data) {\n    item.data.forEach(function (child) {\n      setIsRefined(child, currentRefinement, depth + 1);\n    });\n  }\n}\n\n/**\n * Sort nodes of a hierarchical or disjunctive facet results\n * @private\n * @param {function} sortFn\n * @param {HierarchicalFacet|Array} node node upon which we want to apply the sort\n * @param {string[]} names attribute names\n * @param {number} [level=0] current index in the names array\n */\nfunction recSort(sortFn, node, names, level) {\n  level = level || 0;\n  if (Array.isArray(node)) {\n    return sortFn(node, names[level]);\n  }\n  if (!node.data || node.data.length === 0) {\n    return node;\n  }\n  var children = node.data.map(function (childNode) {\n    return recSort(sortFn, childNode, names, level + 1);\n  });\n  var sortedChildren = sortFn(children, names[level]);\n  var newNode = defaultsPure({\n    data: sortedChildren\n  }, node);\n  return newNode;\n}\nSearchResults.DEFAULT_SORT = ['isRefined:desc', 'count:desc', 'name:asc'];\nfunction vanillaSortFn(order, data) {\n  return data.sort(order);\n}\n\n/**\n * @typedef FacetOrdering\n * @type {Object}\n * @property {string[]} [order]\n * @property {'count' | 'alpha' | 'hidden'} [sortRemainingBy]\n */\n\n/**\n * Sorts facet arrays via their facet ordering\n * @param {Array} facetValues the values\n * @param {FacetOrdering} facetOrdering the ordering\n * @returns {Array}\n */\nfunction sortViaFacetOrdering(facetValues, facetOrdering) {\n  var orderedFacets = [];\n  var remainingFacets = [];\n  var order = facetOrdering.order || [];\n  /**\n   * an object with the keys being the values in order, the values their index:\n   * ['one', 'two'] -> { one: 0, two: 1 }\n   */\n  var reverseOrder = order.reduce(function (acc, name, i) {\n    acc[name] = i;\n    return acc;\n  }, {});\n  facetValues.forEach(function (item) {\n    // hierarchical facets get sorted using their raw name\n    var name = item.path || item.name;\n    if (reverseOrder[name] !== undefined) {\n      orderedFacets[reverseOrder[name]] = item;\n    } else {\n      remainingFacets.push(item);\n    }\n  });\n  orderedFacets = orderedFacets.filter(function (facet) {\n    return facet;\n  });\n  var sortRemainingBy = facetOrdering.sortRemainingBy;\n  var ordering;\n  if (sortRemainingBy === 'hidden') {\n    return orderedFacets;\n  } else if (sortRemainingBy === 'alpha') {\n    ordering = [['path', 'name'], ['asc', 'asc']];\n  } else {\n    ordering = [['count'], ['desc']];\n  }\n  return orderedFacets.concat(orderBy(remainingFacets, ordering[0], ordering[1]));\n}\n\n/**\n * @param {SearchResults} results the search results class\n * @param {string} attribute the attribute to retrieve ordering of\n * @returns {FacetOrdering=}\n */\nfunction getFacetOrdering(results, attribute) {\n  return results.renderingContent && results.renderingContent.facetOrdering && results.renderingContent.facetOrdering.values && results.renderingContent.facetOrdering.values[attribute];\n}\n\n/**\n * Get a the list of values for a given facet attribute. Those values are sorted\n * refinement first, descending count (bigger value on top), and name ascending\n * (alphabetical order). The sort formula can overridden using either string based\n * predicates or a function.\n *\n * This method will return all the values returned by the Algolia engine plus all\n * the values already refined. This means that it can happen that the\n * `maxValuesPerFacet` [configuration](https://www.algolia.com/doc/rest-api/search#param-maxValuesPerFacet)\n * might not be respected if you have facet values that are already refined.\n * @param {string} attribute attribute name\n * @param {object} opts configuration options.\n * @param {boolean} [opts.facetOrdering]\n * Force the use of facetOrdering from the result if a sortBy is present. If\n * sortBy isn't present, facetOrdering will be used automatically.\n * @param {Array.<string> | function} opts.sortBy\n * When using strings, it consists of\n * the name of the [FacetValue](#SearchResults.FacetValue) or the\n * [HierarchicalFacet](#SearchResults.HierarchicalFacet) attributes with the\n * order (`asc` or `desc`). For example to order the value by count, the\n * argument would be `['count:asc']`.\n *\n * If only the attribute name is specified, the ordering defaults to the one\n * specified in the default value for this attribute.\n *\n * When not specified, the order is\n * ascending.  This parameter can also be a function which takes two facet\n * values and should return a number, 0 if equal, 1 if the first argument is\n * bigger or -1 otherwise.\n *\n * The default value for this attribute `['isRefined:desc', 'count:desc', 'name:asc']`\n * @return {FacetValue[]|HierarchicalFacet|undefined} depending on the type of facet of\n * the attribute requested (hierarchical, disjunctive or conjunctive)\n * @example\n * helper.on('result', function(event){\n *   //get values ordered only by name ascending using the string predicate\n *   event.results.getFacetValues('city', {sortBy: ['name:asc']});\n *   //get values  ordered only by count ascending using a function\n *   event.results.getFacetValues('city', {\n *     // this is equivalent to ['count:asc']\n *     sortBy: function(a, b) {\n *       if (a.count === b.count) return 0;\n *       if (a.count > b.count)   return 1;\n *       if (b.count > a.count)   return -1;\n *     }\n *   });\n * });\n */\nSearchResults.prototype.getFacetValues = function (attribute, opts) {\n  var facetValues = extractNormalizedFacetValues(this, attribute);\n  if (!facetValues) {\n    return undefined;\n  }\n  var options = defaultsPure({}, opts, {\n    sortBy: SearchResults.DEFAULT_SORT,\n    // if no sortBy is given, attempt to sort based on facetOrdering\n    // if it is given, we still allow to sort via facet ordering first\n    facetOrdering: !(opts && opts.sortBy)\n  });\n  var results = this;\n  var attributes;\n  if (Array.isArray(facetValues)) {\n    attributes = [attribute];\n  } else {\n    var config = results._state.getHierarchicalFacetByName(facetValues.name);\n    attributes = config.attributes;\n  }\n  return recSort(function (data, facetName) {\n    if (options.facetOrdering) {\n      var facetOrdering = getFacetOrdering(results, facetName);\n      if (Boolean(facetOrdering)) {\n        return sortViaFacetOrdering(data, facetOrdering);\n      }\n    }\n    if (Array.isArray(options.sortBy)) {\n      var order = formatSort(options.sortBy, SearchResults.DEFAULT_SORT);\n      return orderBy(data, order[0], order[1]);\n    } else if (typeof options.sortBy === 'function') {\n      return vanillaSortFn(options.sortBy, data);\n    }\n    throw new Error('options.sortBy is optional but if defined it must be ' + 'either an array of string (predicates) or a sorting function');\n  }, facetValues, attributes);\n};\n\n/**\n * Returns the facet stats if attribute is defined and the facet contains some.\n * Otherwise returns undefined.\n * @param {string} attribute name of the faceted attribute\n * @return {object} The stats of the facet\n */\nSearchResults.prototype.getFacetStats = function (attribute) {\n  if (this._state.isConjunctiveFacet(attribute)) {\n    return getFacetStatsIfAvailable(this.facets, attribute);\n  } else if (this._state.isDisjunctiveFacet(attribute)) {\n    return getFacetStatsIfAvailable(this.disjunctiveFacets, attribute);\n  }\n  return undefined;\n};\n\n/**\n * @typedef {Object} FacetListItem\n * @property {string} name\n */\n\n/**\n * @param {FacetListItem[]} facetList (has more items, but enough for here)\n * @param {string} facetName\n */\nfunction getFacetStatsIfAvailable(facetList, facetName) {\n  var data = find(facetList, function (facet) {\n    return facet.name === facetName;\n  });\n  return data && data.stats;\n}\n\n/**\n * Returns all refinements for all filters + tags. It also provides\n * additional information: count and exhaustiveness for each filter.\n *\n * See the [refinement type](#Refinement) for an exhaustive view of the available\n * data.\n *\n * Note that for a numeric refinement, results are grouped per operator, this\n * means that it will return responses for operators which are empty.\n *\n * @return {Array.<Refinement>} all the refinements\n */\nSearchResults.prototype.getRefinements = function () {\n  var state = this._state;\n  var results = this;\n  var res = [];\n  Object.keys(state.facetsRefinements).forEach(function (attributeName) {\n    state.facetsRefinements[attributeName].forEach(function (name) {\n      res.push(getRefinement(state, 'facet', attributeName, name, results.facets));\n    });\n  });\n  Object.keys(state.facetsExcludes).forEach(function (attributeName) {\n    state.facetsExcludes[attributeName].forEach(function (name) {\n      res.push(getRefinement(state, 'exclude', attributeName, name, results.facets));\n    });\n  });\n  Object.keys(state.disjunctiveFacetsRefinements).forEach(function (attributeName) {\n    state.disjunctiveFacetsRefinements[attributeName].forEach(function (name) {\n      res.push(getRefinement(state, 'disjunctive', attributeName, name, results.disjunctiveFacets));\n    });\n  });\n  Object.keys(state.hierarchicalFacetsRefinements).forEach(function (attributeName) {\n    state.hierarchicalFacetsRefinements[attributeName].forEach(function (name) {\n      res.push(getHierarchicalRefinement(state, attributeName, name, results.hierarchicalFacets));\n    });\n  });\n  Object.keys(state.numericRefinements).forEach(function (attributeName) {\n    var operators = state.numericRefinements[attributeName];\n    Object.keys(operators).forEach(function (operator) {\n      operators[operator].forEach(function (value) {\n        res.push({\n          type: 'numeric',\n          attributeName: attributeName,\n          name: value,\n          numericValue: value,\n          operator: operator\n        });\n      });\n    });\n  });\n  state.tagRefinements.forEach(function (name) {\n    res.push({\n      type: 'tag',\n      attributeName: '_tags',\n      name: name\n    });\n  });\n  return res;\n};\n\n/**\n * @typedef {Object} Facet\n * @property {string} name\n * @property {Object} data\n * @property {boolean} exhaustive\n */\n\n/**\n * @param {*} state\n * @param {*} type\n * @param {string} attributeName\n * @param {*} name\n * @param {Facet[]} resultsFacets\n */\nfunction getRefinement(state, type, attributeName, name, resultsFacets) {\n  var facet = find(resultsFacets, function (f) {\n    return f.name === attributeName;\n  });\n  var count = facet && facet.data && facet.data[name] ? facet.data[name] : 0;\n  var exhaustive = facet && facet.exhaustive || false;\n  return {\n    type: type,\n    attributeName: attributeName,\n    name: name,\n    count: count,\n    exhaustive: exhaustive\n  };\n}\n\n/**\n * @param {*} state\n * @param {string} attributeName\n * @param {*} name\n * @param {Facet[]} resultsFacets\n */\nfunction getHierarchicalRefinement(state, attributeName, name, resultsFacets) {\n  var facetDeclaration = state.getHierarchicalFacetByName(attributeName);\n  var separator = state._getHierarchicalFacetSeparator(facetDeclaration);\n  var split = name.split(separator);\n  var rootFacet = find(resultsFacets, function (facet) {\n    return facet.name === attributeName;\n  });\n  var facet = split.reduce(function (intermediateFacet, part) {\n    var newFacet = intermediateFacet && find(intermediateFacet.data, function (f) {\n      return f.name === part;\n    });\n    return newFacet !== undefined ? newFacet : intermediateFacet;\n  }, rootFacet);\n  var count = facet && facet.count || 0;\n  var exhaustive = facet && facet.exhaustive || false;\n  var path = facet && facet.path || '';\n  return {\n    type: 'hierarchical',\n    attributeName: attributeName,\n    name: path,\n    count: count,\n    exhaustive: exhaustive\n  };\n}\nmodule.exports = SearchResults;","map":{"version":3,"names":["merge","require","defaultsPure","orderBy","compact","find","findIndex","formatSort","fv","escapeFacetValue","unescapeFacetValue","generateHierarchicalTree","getIndices","attributes","indices","forEach","val","idx","assignFacetStats","dest","facetStats","key","stats","findMatchingHierarchicalFacetFromAttributeName","hierarchicalFacets","hierarchicalAttributeName","facetKeyMatchesAttribute","hierarchicalFacet","facetNames","indexOf","SearchResults","state","results","options","mainSubResponse","_rawResults","self","Object","keys","processingTimeMS","reduce","sum","result","undefined","disjunctiveFacets","map","initFutureTree","facets","getRefinedDisjunctiveFacets","facetsIndices","disjunctiveFacetsIndices","nextDisjunctiveResult","mainFacets","facetKey","facetValueObject","facetIndex","idxAttributeName","f","name","attribute","data","exhaustive","exhaustiveFacetsCount","isFacetDisjunctive","isFacetConjunctive","position","facets_stats","disjunctiveFacet","getHierarchicalFacetByName","dfacet","facetResults","attributeIndex","dataFromMainRequest","disjunctiveFacetsRefinements","refinementValue","getRefinedHierarchicalFacets","refinedFacet","separator","_getHierarchicalFacetSeparator","currentRefinement","getHierarchicalRefinement","length","split","slice","defaultData","root","facetsExcludes","facetName","excludes","facetValue","_state","prototype","getFacetByName","predicate","facet","extractNormalizedFacetValues","isConjunctiveFacet","value","escapedValue","count","isRefined","isFacetRefined","isExcluded","isExcludeRefined","isDisjunctiveFacet","isDisjunctiveFacetRefined","isHierarchicalFacet","hierarchicalFacetValues","currentRefinementSplit","unshift","setIsRefined","item","depth","child","recSort","sortFn","node","names","level","Array","isArray","children","childNode","sortedChildren","newNode","DEFAULT_SORT","vanillaSortFn","order","sort","sortViaFacetOrdering","facetValues","facetOrdering","orderedFacets","remainingFacets","reverseOrder","acc","i","path","push","filter","sortRemainingBy","ordering","concat","getFacetOrdering","renderingContent","values","getFacetValues","opts","sortBy","config","Boolean","Error","getFacetStats","getFacetStatsIfAvailable","facetList","getRefinements","res","facetsRefinements","attributeName","getRefinement","hierarchicalFacetsRefinements","numericRefinements","operators","operator","type","numericValue","tagRefinements","resultsFacets","facetDeclaration","rootFacet","intermediateFacet","part","newFacet","module","exports"],"sources":["/Users/amandawinkler/Desktop/algolia-instantsearch-react-geo/node_modules/algoliasearch-helper/src/SearchResults/index.js"],"sourcesContent":["'use strict';\n\nvar merge = require('../functions/merge');\nvar defaultsPure = require('../functions/defaultsPure');\nvar orderBy = require('../functions/orderBy');\nvar compact = require('../functions/compact');\nvar find = require('../functions/find');\nvar findIndex = require('../functions/findIndex');\nvar formatSort = require('../functions/formatSort');\nvar fv = require('../functions/escapeFacetValue');\nvar escapeFacetValue = fv.escapeFacetValue;\nvar unescapeFacetValue = fv.unescapeFacetValue;\n\nvar generateHierarchicalTree = require('./generate-hierarchical-tree');\n\n/**\n * @typedef SearchResults.Facet\n * @type {object}\n * @property {string} name name of the attribute in the record\n * @property {object} data the faceting data: value, number of entries\n * @property {object} stats undefined unless facet_stats is retrieved from algolia\n */\n\n/**\n * @typedef SearchResults.HierarchicalFacet\n * @type {object}\n * @property {string} name name of the current value given the hierarchical level, trimmed.\n * If root node, you get the facet name\n * @property {number} count number of objects matching this hierarchical value\n * @property {string} path the current hierarchical value full path\n * @property {boolean} isRefined `true` if the current value was refined, `false` otherwise\n * @property {HierarchicalFacet[]} data sub values for the current level\n */\n\n/**\n * @typedef SearchResults.FacetValue\n * @type {object}\n * @property {string} name the facet value itself\n * @property {number} count times this facet appears in the results\n * @property {boolean} isRefined is the facet currently selected\n * @property {boolean} isExcluded is the facet currently excluded (only for conjunctive facets)\n */\n\n/**\n * @typedef Refinement\n * @type {object}\n * @property {string} type the type of filter used:\n * `numeric`, `facet`, `exclude`, `disjunctive`, `hierarchical`\n * @property {string} attributeName name of the attribute used for filtering\n * @property {string} name the value of the filter\n * @property {number} numericValue the value as a number. Only for numeric filters.\n * @property {string} operator the operator used. Only for numeric filters.\n * @property {number} count the number of computed hits for this filter. Only on facets.\n * @property {boolean} exhaustive if the count is exhaustive\n */\n\n/**\n * @param {string[]} attributes\n */\nfunction getIndices(attributes) {\n  var indices = {};\n\n  attributes.forEach(function(val, idx) {\n    indices[val] = idx;\n  });\n\n  return indices;\n}\n\nfunction assignFacetStats(dest, facetStats, key) {\n  if (facetStats && facetStats[key]) {\n    dest.stats = facetStats[key];\n  }\n}\n\n/**\n * @typedef {Object} HierarchicalFacet\n * @property {string} name\n * @property {string[]} attributes\n */\n\n/**\n * @param {HierarchicalFacet[]} hierarchicalFacets\n * @param {string} hierarchicalAttributeName\n */\nfunction findMatchingHierarchicalFacetFromAttributeName(\n  hierarchicalFacets,\n  hierarchicalAttributeName\n) {\n  return find(hierarchicalFacets, function facetKeyMatchesAttribute(\n    hierarchicalFacet\n  ) {\n    var facetNames = hierarchicalFacet.attributes || [];\n    return facetNames.indexOf(hierarchicalAttributeName) > -1;\n  });\n}\n\n/*eslint-disable */\n/**\n * Constructor for SearchResults\n * @class\n * @classdesc SearchResults contains the results of a query to Algolia using the\n * {@link AlgoliaSearchHelper}.\n * @param {SearchParameters} state state that led to the response\n * @param {array.<object>} results the results from algolia client\n * @example <caption>SearchResults of the first query in\n * <a href=\"http://demos.algolia.com/instant-search-demo\">the instant search demo</a></caption>\n{\n   \"hitsPerPage\": 10,\n   \"processingTimeMS\": 2,\n   \"facets\": [\n      {\n         \"name\": \"type\",\n         \"data\": {\n            \"HardGood\": 6627,\n            \"BlackTie\": 550,\n            \"Music\": 665,\n            \"Software\": 131,\n            \"Game\": 456,\n            \"Movie\": 1571\n         },\n         \"exhaustive\": false\n      },\n      {\n         \"exhaustive\": false,\n         \"data\": {\n            \"Free shipping\": 5507\n         },\n         \"name\": \"shipping\"\n      }\n  ],\n   \"hits\": [\n      {\n         \"thumbnailImage\": \"http://img.bbystatic.com/BestBuy_US/images/products/1688/1688832_54x108_s.gif\",\n         \"_highlightResult\": {\n            \"shortDescription\": {\n               \"matchLevel\": \"none\",\n               \"value\": \"Safeguard your PC, Mac, Android and iOS devices with comprehensive Internet protection\",\n               \"matchedWords\": []\n            },\n            \"category\": {\n               \"matchLevel\": \"none\",\n               \"value\": \"Computer Security Software\",\n               \"matchedWords\": []\n            },\n            \"manufacturer\": {\n               \"matchedWords\": [],\n               \"value\": \"Webroot\",\n               \"matchLevel\": \"none\"\n            },\n            \"name\": {\n               \"value\": \"Webroot SecureAnywhere Internet Security (3-Device) (1-Year Subscription) - Mac/Windows\",\n               \"matchedWords\": [],\n               \"matchLevel\": \"none\"\n            }\n         },\n         \"image\": \"http://img.bbystatic.com/BestBuy_US/images/products/1688/1688832_105x210_sc.jpg\",\n         \"shipping\": \"Free shipping\",\n         \"bestSellingRank\": 4,\n         \"shortDescription\": \"Safeguard your PC, Mac, Android and iOS devices with comprehensive Internet protection\",\n         \"url\": \"http://www.bestbuy.com/site/webroot-secureanywhere-internet-security-3-devi…d=1219060687969&skuId=1688832&cmp=RMX&ky=2d3GfEmNIzjA0vkzveHdZEBgpPCyMnLTJ\",\n         \"name\": \"Webroot SecureAnywhere Internet Security (3-Device) (1-Year Subscription) - Mac/Windows\",\n         \"category\": \"Computer Security Software\",\n         \"salePrice_range\": \"1 - 50\",\n         \"objectID\": \"1688832\",\n         \"type\": \"Software\",\n         \"customerReviewCount\": 5980,\n         \"salePrice\": 49.99,\n         \"manufacturer\": \"Webroot\"\n      },\n      ....\n  ],\n   \"nbHits\": 10000,\n   \"disjunctiveFacets\": [\n      {\n         \"exhaustive\": false,\n         \"data\": {\n            \"5\": 183,\n            \"12\": 112,\n            \"7\": 149,\n            ...\n         },\n         \"name\": \"customerReviewCount\",\n         \"stats\": {\n            \"max\": 7461,\n            \"avg\": 157.939,\n            \"min\": 1\n         }\n      },\n      {\n         \"data\": {\n            \"Printer Ink\": 142,\n            \"Wireless Speakers\": 60,\n            \"Point & Shoot Cameras\": 48,\n            ...\n         },\n         \"name\": \"category\",\n         \"exhaustive\": false\n      },\n      {\n         \"exhaustive\": false,\n         \"data\": {\n            \"> 5000\": 2,\n            \"1 - 50\": 6524,\n            \"501 - 2000\": 566,\n            \"201 - 500\": 1501,\n            \"101 - 200\": 1360,\n            \"2001 - 5000\": 47\n         },\n         \"name\": \"salePrice_range\"\n      },\n      {\n         \"data\": {\n            \"Dynex™\": 202,\n            \"Insignia™\": 230,\n            \"PNY\": 72,\n            ...\n         },\n         \"name\": \"manufacturer\",\n         \"exhaustive\": false\n      }\n  ],\n   \"query\": \"\",\n   \"nbPages\": 100,\n   \"page\": 0,\n   \"index\": \"bestbuy\"\n}\n **/\n/*eslint-enable */\nfunction SearchResults(state, results, options) {\n  var mainSubResponse = results[0];\n\n  this._rawResults = results;\n\n  var self = this;\n\n  // https://www.algolia.com/doc/api-reference/api-methods/search/#response\n  Object.keys(mainSubResponse).forEach(function(key) {\n    self[key] = mainSubResponse[key];\n  });\n\n  // Make every key of the result options reachable from the instance\n  Object.keys(options || {}).forEach(function(key) {\n    self[key] = options[key];\n  });\n\n  /**\n   * query used to generate the results\n   * @name query\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * The query as parsed by the engine given all the rules.\n   * @name parsedQuery\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * all the records that match the search parameters. Each record is\n   * augmented with a new attribute `_highlightResult`\n   * which is an object keyed by attribute and with the following properties:\n   *  - `value` : the value of the facet highlighted (html)\n   *  - `matchLevel`: full, partial or none depending on how the query terms match\n   * @name hits\n   * @member {object[]}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * index where the results come from\n   * @name index\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * number of hits per page requested\n   * @name hitsPerPage\n   * @member {number}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * total number of hits of this query on the index\n   * @name nbHits\n   * @member {number}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * total number of pages with respect to the number of hits per page and the total number of hits\n   * @name nbPages\n   * @member {number}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * current page\n   * @name page\n   * @member {number}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * The position if the position was guessed by IP.\n   * @name aroundLatLng\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   * @example \"48.8637,2.3615\",\n   */\n  /**\n   * The radius computed by Algolia.\n   * @name automaticRadius\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   * @example \"126792922\",\n   */\n  /**\n   * String identifying the server used to serve this request.\n   *\n   * getRankingInfo needs to be set to `true` for this to be returned\n   *\n   * @name serverUsed\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   * @example \"c7-use-2.algolia.net\",\n   */\n  /**\n   * Boolean that indicates if the computation of the counts did time out.\n   * @deprecated\n   * @name timeoutCounts\n   * @member {boolean}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * Boolean that indicates if the computation of the hits did time out.\n   * @deprecated\n   * @name timeoutHits\n   * @member {boolean}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * True if the counts of the facets is exhaustive\n   * @name exhaustiveFacetsCount\n   * @member {boolean}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * True if the number of hits is exhaustive\n   * @name exhaustiveNbHits\n   * @member {boolean}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * Contains the userData if they are set by a [query rule](https://www.algolia.com/doc/guides/query-rules/query-rules-overview/).\n   * @name userData\n   * @member {object[]}\n   * @memberof SearchResults\n   * @instance\n   */\n  /**\n   * queryID is the unique identifier of the query used to generate the current search results.\n   * This value is only available if the `clickAnalytics` search parameter is set to `true`.\n   * @name queryID\n   * @member {string}\n   * @memberof SearchResults\n   * @instance\n   */\n\n  /**\n   * sum of the processing time of all the queries\n   * @member {number}\n   */\n  this.processingTimeMS = results.reduce(function(sum, result) {\n    return result.processingTimeMS === undefined\n      ? sum\n      : sum + result.processingTimeMS;\n  }, 0);\n\n  /**\n   * disjunctive facets results\n   * @member {SearchResults.Facet[]}\n   */\n  this.disjunctiveFacets = [];\n  /**\n   * disjunctive facets results\n   * @member {SearchResults.HierarchicalFacet[]}\n   */\n  this.hierarchicalFacets = state.hierarchicalFacets.map(function initFutureTree() {\n    return [];\n  });\n  /**\n   * other facets results\n   * @member {SearchResults.Facet[]}\n   */\n  this.facets = [];\n\n  var disjunctiveFacets = state.getRefinedDisjunctiveFacets();\n\n  var facetsIndices = getIndices(state.facets);\n  var disjunctiveFacetsIndices = getIndices(state.disjunctiveFacets);\n  var nextDisjunctiveResult = 1;\n\n  // Since we send request only for disjunctive facets that have been refined,\n  // we get the facets information from the first, general, response.\n\n  var mainFacets = mainSubResponse.facets || {};\n\n  Object.keys(mainFacets).forEach(function(facetKey) {\n    var facetValueObject = mainFacets[facetKey];\n\n    var hierarchicalFacet = findMatchingHierarchicalFacetFromAttributeName(\n      state.hierarchicalFacets,\n      facetKey\n    );\n\n    if (hierarchicalFacet) {\n      // Place the hierarchicalFacet data at the correct index depending on\n      // the attributes order that was defined at the helper initialization\n      var facetIndex = hierarchicalFacet.attributes.indexOf(facetKey);\n      var idxAttributeName = findIndex(state.hierarchicalFacets, function(f) {\n        return f.name === hierarchicalFacet.name;\n      });\n      self.hierarchicalFacets[idxAttributeName][facetIndex] = {\n        attribute: facetKey,\n        data: facetValueObject,\n        exhaustive: mainSubResponse.exhaustiveFacetsCount\n      };\n    } else {\n      var isFacetDisjunctive = state.disjunctiveFacets.indexOf(facetKey) !== -1;\n      var isFacetConjunctive = state.facets.indexOf(facetKey) !== -1;\n      var position;\n\n      if (isFacetDisjunctive) {\n        position = disjunctiveFacetsIndices[facetKey];\n        self.disjunctiveFacets[position] = {\n          name: facetKey,\n          data: facetValueObject,\n          exhaustive: mainSubResponse.exhaustiveFacetsCount\n        };\n        assignFacetStats(self.disjunctiveFacets[position], mainSubResponse.facets_stats, facetKey);\n      }\n      if (isFacetConjunctive) {\n        position = facetsIndices[facetKey];\n        self.facets[position] = {\n          name: facetKey,\n          data: facetValueObject,\n          exhaustive: mainSubResponse.exhaustiveFacetsCount\n        };\n        assignFacetStats(self.facets[position], mainSubResponse.facets_stats, facetKey);\n      }\n    }\n  });\n\n  // Make sure we do not keep holes within the hierarchical facets\n  this.hierarchicalFacets = compact(this.hierarchicalFacets);\n\n  // aggregate the refined disjunctive facets\n  disjunctiveFacets.forEach(function(disjunctiveFacet) {\n    var result = results[nextDisjunctiveResult];\n    var facets = result && result.facets ? result.facets : {};\n    var hierarchicalFacet = state.getHierarchicalFacetByName(disjunctiveFacet);\n\n    // There should be only item in facets.\n    Object.keys(facets).forEach(function(dfacet) {\n      var facetResults = facets[dfacet];\n\n      var position;\n\n      if (hierarchicalFacet) {\n        position = findIndex(state.hierarchicalFacets, function(f) {\n          return f.name === hierarchicalFacet.name;\n        });\n        var attributeIndex = findIndex(self.hierarchicalFacets[position], function(f) {\n          return f.attribute === dfacet;\n        });\n\n        // previous refinements and no results so not able to find it\n        if (attributeIndex === -1) {\n          return;\n        }\n\n        self.hierarchicalFacets[position][attributeIndex].data = merge(\n          {},\n          self.hierarchicalFacets[position][attributeIndex].data,\n          facetResults\n        );\n      } else {\n        position = disjunctiveFacetsIndices[dfacet];\n\n        var dataFromMainRequest = mainSubResponse.facets && mainSubResponse.facets[dfacet] || {};\n\n        self.disjunctiveFacets[position] = {\n          name: dfacet,\n          data: defaultsPure({}, facetResults, dataFromMainRequest),\n          exhaustive: result.exhaustiveFacetsCount\n        };\n        assignFacetStats(self.disjunctiveFacets[position], result.facets_stats, dfacet);\n\n        if (state.disjunctiveFacetsRefinements[dfacet]) {\n          state.disjunctiveFacetsRefinements[dfacet].forEach(function(refinementValue) {\n            // add the disjunctive refinements if it is no more retrieved\n            if (!self.disjunctiveFacets[position].data[refinementValue] &&\n              state.disjunctiveFacetsRefinements[dfacet].indexOf(unescapeFacetValue(refinementValue)) > -1) {\n              self.disjunctiveFacets[position].data[refinementValue] = 0;\n            }\n          });\n        }\n      }\n    });\n    nextDisjunctiveResult++;\n  });\n\n  // if we have some parent level values for hierarchical facets, merge them\n  state.getRefinedHierarchicalFacets().forEach(function(refinedFacet) {\n    var hierarchicalFacet = state.getHierarchicalFacetByName(refinedFacet);\n    var separator = state._getHierarchicalFacetSeparator(hierarchicalFacet);\n\n    var currentRefinement = state.getHierarchicalRefinement(refinedFacet);\n    // if we are already at a root refinement (or no refinement at all), there is no\n    // root level values request\n    if (currentRefinement.length === 0 || currentRefinement[0].split(separator).length < 2) {\n      return;\n    }\n\n    results.slice(nextDisjunctiveResult).forEach(function(result) {\n      var facets = result && result.facets\n        ? result.facets\n        : {};\n\n      Object.keys(facets).forEach(function(dfacet) {\n        var facetResults = facets[dfacet];\n        var position = findIndex(state.hierarchicalFacets, function(f) {\n          return f.name === hierarchicalFacet.name;\n        });\n        var attributeIndex = findIndex(self.hierarchicalFacets[position], function(f) {\n          return f.attribute === dfacet;\n        });\n\n        // previous refinements and no results so not able to find it\n        if (attributeIndex === -1) {\n          return;\n        }\n\n        // when we always get root levels, if the hits refinement is `beers > IPA` (count: 5),\n        // then the disjunctive values will be `beers` (count: 100),\n        // but we do not want to display\n        //   | beers (100)\n        //     > IPA (5)\n        // We want\n        //   | beers (5)\n        //     > IPA (5)\n        var defaultData = {};\n\n        if (currentRefinement.length > 0) {\n          var root = currentRefinement[0].split(separator)[0];\n          defaultData[root] = self.hierarchicalFacets[position][attributeIndex].data[root];\n        }\n\n        self.hierarchicalFacets[position][attributeIndex].data = defaultsPure(\n          defaultData,\n          facetResults,\n          self.hierarchicalFacets[position][attributeIndex].data\n        );\n      });\n\n      nextDisjunctiveResult++;\n    });\n  });\n\n  // add the excludes\n  Object.keys(state.facetsExcludes).forEach(function(facetName) {\n    var excludes = state.facetsExcludes[facetName];\n    var position = facetsIndices[facetName];\n\n    self.facets[position] = {\n      name: facetName,\n      data: mainSubResponse.facets[facetName],\n      exhaustive: mainSubResponse.exhaustiveFacetsCount\n    };\n    excludes.forEach(function(facetValue) {\n      self.facets[position] = self.facets[position] || {name: facetName};\n      self.facets[position].data = self.facets[position].data || {};\n      self.facets[position].data[facetValue] = 0;\n    });\n  });\n\n  /**\n   * @type {Array}\n   */\n  this.hierarchicalFacets = this.hierarchicalFacets.map(generateHierarchicalTree(state));\n\n  /**\n   * @type {Array}\n   */\n  this.facets = compact(this.facets);\n  /**\n   * @type {Array}\n   */\n  this.disjunctiveFacets = compact(this.disjunctiveFacets);\n\n  this._state = state;\n}\n\n/**\n * Get a facet object with its name\n * @deprecated\n * @param {string} name name of the faceted attribute\n * @return {SearchResults.Facet} the facet object\n */\nSearchResults.prototype.getFacetByName = function(name) {\n  function predicate(facet) {\n    return facet.name === name;\n  }\n\n  return find(this.facets, predicate) ||\n    find(this.disjunctiveFacets, predicate) ||\n    find(this.hierarchicalFacets, predicate);\n};\n\n/**\n * Get the facet values of a specified attribute from a SearchResults object.\n * @private\n * @param {SearchResults} results the search results to search in\n * @param {string} attribute name of the faceted attribute to search for\n * @return {array|object} facet values. For the hierarchical facets it is an object.\n */\nfunction extractNormalizedFacetValues(results, attribute) {\n  function predicate(facet) {\n    return facet.name === attribute;\n  }\n\n  if (results._state.isConjunctiveFacet(attribute)) {\n    var facet = find(results.facets, predicate);\n    if (!facet) return [];\n\n    return Object.keys(facet.data).map(function(name) {\n      var value = escapeFacetValue(name);\n      return {\n        name: name,\n        escapedValue: value,\n        count: facet.data[name],\n        isRefined: results._state.isFacetRefined(attribute, value),\n        isExcluded: results._state.isExcludeRefined(attribute, name)\n      };\n    });\n  } else if (results._state.isDisjunctiveFacet(attribute)) {\n    var disjunctiveFacet = find(results.disjunctiveFacets, predicate);\n    if (!disjunctiveFacet) return [];\n\n    return Object.keys(disjunctiveFacet.data).map(function(name) {\n      var value = escapeFacetValue(name);\n      return {\n        name: name,\n        escapedValue: value,\n        count: disjunctiveFacet.data[name],\n        isRefined: results._state.isDisjunctiveFacetRefined(attribute, value)\n      };\n    });\n  } else if (results._state.isHierarchicalFacet(attribute)) {\n    var hierarchicalFacetValues = find(results.hierarchicalFacets, predicate);\n    if (!hierarchicalFacetValues) return hierarchicalFacetValues;\n\n    var hierarchicalFacet = results._state.getHierarchicalFacetByName(attribute);\n    var currentRefinementSplit = unescapeFacetValue(\n      results._state.getHierarchicalRefinement(attribute)[0] || ''\n    ).split(results._state._getHierarchicalFacetSeparator(hierarchicalFacet));\n    currentRefinementSplit.unshift(attribute);\n\n    setIsRefined(hierarchicalFacetValues, currentRefinementSplit, 0);\n\n    return hierarchicalFacetValues;\n  }\n}\n\n/**\n * Set the isRefined of a hierarchical facet result based on the current state.\n * @param {SearchResults.HierarchicalFacet} item Hierarchical facet to fix\n * @param {string[]} currentRefinementSplit array of parts of the current hierarchical refinement\n * @param {number} depth recursion depth in the currentRefinement\n */\nfunction setIsRefined(item, currentRefinement, depth) {\n  item.isRefined = item.name === currentRefinement[depth];\n  if (item.data) {\n    item.data.forEach(function(child) {\n      setIsRefined(child, currentRefinement, depth + 1);\n    });\n  }\n}\n\n/**\n * Sort nodes of a hierarchical or disjunctive facet results\n * @private\n * @param {function} sortFn\n * @param {HierarchicalFacet|Array} node node upon which we want to apply the sort\n * @param {string[]} names attribute names\n * @param {number} [level=0] current index in the names array\n */\nfunction recSort(sortFn, node, names, level) {\n  level = level || 0;\n\n  if (Array.isArray(node)) {\n    return sortFn(node, names[level]);\n  }\n\n  if (!node.data || node.data.length === 0) {\n    return node;\n  }\n\n  var children = node.data.map(function(childNode) {\n    return recSort(sortFn, childNode, names, level + 1);\n  });\n  var sortedChildren = sortFn(children, names[level]);\n  var newNode = defaultsPure({data: sortedChildren}, node);\n  return newNode;\n}\n\nSearchResults.DEFAULT_SORT = ['isRefined:desc', 'count:desc', 'name:asc'];\n\nfunction vanillaSortFn(order, data) {\n  return data.sort(order);\n}\n\n/**\n * @typedef FacetOrdering\n * @type {Object}\n * @property {string[]} [order]\n * @property {'count' | 'alpha' | 'hidden'} [sortRemainingBy]\n */\n\n/**\n * Sorts facet arrays via their facet ordering\n * @param {Array} facetValues the values\n * @param {FacetOrdering} facetOrdering the ordering\n * @returns {Array}\n */\nfunction sortViaFacetOrdering(facetValues, facetOrdering) {\n  var orderedFacets = [];\n  var remainingFacets = [];\n\n  var order = facetOrdering.order || [];\n  /**\n   * an object with the keys being the values in order, the values their index:\n   * ['one', 'two'] -> { one: 0, two: 1 }\n   */\n  var reverseOrder = order.reduce(function(acc, name, i) {\n    acc[name] = i;\n    return acc;\n  }, {});\n\n  facetValues.forEach(function(item) {\n    // hierarchical facets get sorted using their raw name\n    var name = item.path || item.name;\n    if (reverseOrder[name] !== undefined) {\n      orderedFacets[reverseOrder[name]] = item;\n    } else {\n      remainingFacets.push(item);\n    }\n  });\n\n  orderedFacets = orderedFacets.filter(function(facet) {\n    return facet;\n  });\n\n  var sortRemainingBy = facetOrdering.sortRemainingBy;\n  var ordering;\n  if (sortRemainingBy === 'hidden') {\n    return orderedFacets;\n  } else if (sortRemainingBy === 'alpha') {\n    ordering = [['path', 'name'], ['asc', 'asc']];\n  } else {\n    ordering = [['count'], ['desc']];\n  }\n\n  return orderedFacets.concat(\n    orderBy(remainingFacets, ordering[0], ordering[1])\n  );\n}\n\n/**\n * @param {SearchResults} results the search results class\n * @param {string} attribute the attribute to retrieve ordering of\n * @returns {FacetOrdering=}\n */\nfunction getFacetOrdering(results, attribute) {\n  return (\n    results.renderingContent &&\n    results.renderingContent.facetOrdering &&\n    results.renderingContent.facetOrdering.values &&\n    results.renderingContent.facetOrdering.values[attribute]\n  );\n}\n\n/**\n * Get a the list of values for a given facet attribute. Those values are sorted\n * refinement first, descending count (bigger value on top), and name ascending\n * (alphabetical order). The sort formula can overridden using either string based\n * predicates or a function.\n *\n * This method will return all the values returned by the Algolia engine plus all\n * the values already refined. This means that it can happen that the\n * `maxValuesPerFacet` [configuration](https://www.algolia.com/doc/rest-api/search#param-maxValuesPerFacet)\n * might not be respected if you have facet values that are already refined.\n * @param {string} attribute attribute name\n * @param {object} opts configuration options.\n * @param {boolean} [opts.facetOrdering]\n * Force the use of facetOrdering from the result if a sortBy is present. If\n * sortBy isn't present, facetOrdering will be used automatically.\n * @param {Array.<string> | function} opts.sortBy\n * When using strings, it consists of\n * the name of the [FacetValue](#SearchResults.FacetValue) or the\n * [HierarchicalFacet](#SearchResults.HierarchicalFacet) attributes with the\n * order (`asc` or `desc`). For example to order the value by count, the\n * argument would be `['count:asc']`.\n *\n * If only the attribute name is specified, the ordering defaults to the one\n * specified in the default value for this attribute.\n *\n * When not specified, the order is\n * ascending.  This parameter can also be a function which takes two facet\n * values and should return a number, 0 if equal, 1 if the first argument is\n * bigger or -1 otherwise.\n *\n * The default value for this attribute `['isRefined:desc', 'count:desc', 'name:asc']`\n * @return {FacetValue[]|HierarchicalFacet|undefined} depending on the type of facet of\n * the attribute requested (hierarchical, disjunctive or conjunctive)\n * @example\n * helper.on('result', function(event){\n *   //get values ordered only by name ascending using the string predicate\n *   event.results.getFacetValues('city', {sortBy: ['name:asc']});\n *   //get values  ordered only by count ascending using a function\n *   event.results.getFacetValues('city', {\n *     // this is equivalent to ['count:asc']\n *     sortBy: function(a, b) {\n *       if (a.count === b.count) return 0;\n *       if (a.count > b.count)   return 1;\n *       if (b.count > a.count)   return -1;\n *     }\n *   });\n * });\n */\nSearchResults.prototype.getFacetValues = function(attribute, opts) {\n  var facetValues = extractNormalizedFacetValues(this, attribute);\n  if (!facetValues) {\n    return undefined;\n  }\n\n  var options = defaultsPure({}, opts, {\n    sortBy: SearchResults.DEFAULT_SORT,\n    // if no sortBy is given, attempt to sort based on facetOrdering\n    // if it is given, we still allow to sort via facet ordering first\n    facetOrdering: !(opts && opts.sortBy)\n  });\n\n  var results = this;\n  var attributes;\n  if (Array.isArray(facetValues)) {\n    attributes = [attribute];\n  } else {\n    var config = results._state.getHierarchicalFacetByName(facetValues.name);\n    attributes = config.attributes;\n  }\n\n  return recSort(function(data, facetName) {\n    if (options.facetOrdering) {\n      var facetOrdering = getFacetOrdering(results, facetName);\n      if (Boolean(facetOrdering)) {\n        return sortViaFacetOrdering(data, facetOrdering);\n      }\n    }\n\n    if (Array.isArray(options.sortBy)) {\n      var order = formatSort(options.sortBy, SearchResults.DEFAULT_SORT);\n      return orderBy(data, order[0], order[1]);\n    } else if (typeof options.sortBy === 'function') {\n      return vanillaSortFn(options.sortBy, data);\n    }\n    throw new Error(\n      'options.sortBy is optional but if defined it must be ' +\n        'either an array of string (predicates) or a sorting function'\n    );\n  }, facetValues, attributes);\n};\n\n/**\n * Returns the facet stats if attribute is defined and the facet contains some.\n * Otherwise returns undefined.\n * @param {string} attribute name of the faceted attribute\n * @return {object} The stats of the facet\n */\nSearchResults.prototype.getFacetStats = function(attribute) {\n  if (this._state.isConjunctiveFacet(attribute)) {\n    return getFacetStatsIfAvailable(this.facets, attribute);\n  } else if (this._state.isDisjunctiveFacet(attribute)) {\n    return getFacetStatsIfAvailable(this.disjunctiveFacets, attribute);\n  }\n\n  return undefined;\n};\n\n/**\n * @typedef {Object} FacetListItem\n * @property {string} name\n */\n\n/**\n * @param {FacetListItem[]} facetList (has more items, but enough for here)\n * @param {string} facetName\n */\nfunction getFacetStatsIfAvailable(facetList, facetName) {\n  var data = find(facetList, function(facet) {\n    return facet.name === facetName;\n  });\n  return data && data.stats;\n}\n\n/**\n * Returns all refinements for all filters + tags. It also provides\n * additional information: count and exhaustiveness for each filter.\n *\n * See the [refinement type](#Refinement) for an exhaustive view of the available\n * data.\n *\n * Note that for a numeric refinement, results are grouped per operator, this\n * means that it will return responses for operators which are empty.\n *\n * @return {Array.<Refinement>} all the refinements\n */\nSearchResults.prototype.getRefinements = function() {\n  var state = this._state;\n  var results = this;\n  var res = [];\n\n  Object.keys(state.facetsRefinements).forEach(function(attributeName) {\n    state.facetsRefinements[attributeName].forEach(function(name) {\n      res.push(getRefinement(state, 'facet', attributeName, name, results.facets));\n    });\n  });\n\n  Object.keys(state.facetsExcludes).forEach(function(attributeName) {\n    state.facetsExcludes[attributeName].forEach(function(name) {\n      res.push(getRefinement(state, 'exclude', attributeName, name, results.facets));\n    });\n  });\n\n  Object.keys(state.disjunctiveFacetsRefinements).forEach(function(attributeName) {\n    state.disjunctiveFacetsRefinements[attributeName].forEach(function(name) {\n      res.push(getRefinement(state, 'disjunctive', attributeName, name, results.disjunctiveFacets));\n    });\n  });\n\n  Object.keys(state.hierarchicalFacetsRefinements).forEach(function(attributeName) {\n    state.hierarchicalFacetsRefinements[attributeName].forEach(function(name) {\n      res.push(getHierarchicalRefinement(state, attributeName, name, results.hierarchicalFacets));\n    });\n  });\n\n\n  Object.keys(state.numericRefinements).forEach(function(attributeName) {\n    var operators = state.numericRefinements[attributeName];\n    Object.keys(operators).forEach(function(operator) {\n      operators[operator].forEach(function(value) {\n        res.push({\n          type: 'numeric',\n          attributeName: attributeName,\n          name: value,\n          numericValue: value,\n          operator: operator\n        });\n      });\n    });\n  });\n\n  state.tagRefinements.forEach(function(name) {\n    res.push({type: 'tag', attributeName: '_tags', name: name});\n  });\n\n  return res;\n};\n\n/**\n * @typedef {Object} Facet\n * @property {string} name\n * @property {Object} data\n * @property {boolean} exhaustive\n */\n\n/**\n * @param {*} state\n * @param {*} type\n * @param {string} attributeName\n * @param {*} name\n * @param {Facet[]} resultsFacets\n */\nfunction getRefinement(state, type, attributeName, name, resultsFacets) {\n  var facet = find(resultsFacets, function(f) {\n    return f.name === attributeName;\n  });\n  var count = facet && facet.data && facet.data[name] ? facet.data[name] : 0;\n  var exhaustive = (facet && facet.exhaustive) || false;\n\n  return {\n    type: type,\n    attributeName: attributeName,\n    name: name,\n    count: count,\n    exhaustive: exhaustive\n  };\n}\n\n/**\n * @param {*} state\n * @param {string} attributeName\n * @param {*} name\n * @param {Facet[]} resultsFacets\n */\nfunction getHierarchicalRefinement(state, attributeName, name, resultsFacets) {\n  var facetDeclaration = state.getHierarchicalFacetByName(attributeName);\n  var separator = state._getHierarchicalFacetSeparator(facetDeclaration);\n  var split = name.split(separator);\n  var rootFacet = find(resultsFacets, function(facet) {\n    return facet.name === attributeName;\n  });\n\n  var facet = split.reduce(function(intermediateFacet, part) {\n    var newFacet =\n      intermediateFacet && find(intermediateFacet.data, function(f) {\n        return f.name === part;\n      });\n    return newFacet !== undefined ? newFacet : intermediateFacet;\n  }, rootFacet);\n\n  var count = (facet && facet.count) || 0;\n  var exhaustive = (facet && facet.exhaustive) || false;\n  var path = (facet && facet.path) || '';\n\n  return {\n    type: 'hierarchical',\n    attributeName: attributeName,\n    name: path,\n    count: count,\n    exhaustive: exhaustive\n  };\n}\n\nmodule.exports = SearchResults;\n"],"mappings":"AAAA,YAAY;;AAEZ,IAAIA,KAAK,GAAGC,OAAO,CAAC,oBAAoB,CAAC;AACzC,IAAIC,YAAY,GAAGD,OAAO,CAAC,2BAA2B,CAAC;AACvD,IAAIE,OAAO,GAAGF,OAAO,CAAC,sBAAsB,CAAC;AAC7C,IAAIG,OAAO,GAAGH,OAAO,CAAC,sBAAsB,CAAC;AAC7C,IAAII,IAAI,GAAGJ,OAAO,CAAC,mBAAmB,CAAC;AACvC,IAAIK,SAAS,GAAGL,OAAO,CAAC,wBAAwB,CAAC;AACjD,IAAIM,UAAU,GAAGN,OAAO,CAAC,yBAAyB,CAAC;AACnD,IAAIO,EAAE,GAAGP,OAAO,CAAC,+BAA+B,CAAC;AACjD,IAAIQ,gBAAgB,GAAGD,EAAE,CAACC,gBAAgB;AAC1C,IAAIC,kBAAkB,GAAGF,EAAE,CAACE,kBAAkB;AAE9C,IAAIC,wBAAwB,GAAGV,OAAO,CAAC,8BAA8B,CAAC;;AAEtE;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAASW,UAAUA,CAACC,UAAU,EAAE;EAC9B,IAAIC,OAAO,GAAG,CAAC,CAAC;EAEhBD,UAAU,CAACE,OAAO,CAAC,UAASC,GAAG,EAAEC,GAAG,EAAE;IACpCH,OAAO,CAACE,GAAG,CAAC,GAAGC,GAAG;EACpB,CAAC,CAAC;EAEF,OAAOH,OAAO;AAChB;AAEA,SAASI,gBAAgBA,CAACC,IAAI,EAAEC,UAAU,EAAEC,GAAG,EAAE;EAC/C,IAAID,UAAU,IAAIA,UAAU,CAACC,GAAG,CAAC,EAAE;IACjCF,IAAI,CAACG,KAAK,GAAGF,UAAU,CAACC,GAAG,CAAC;EAC9B;AACF;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAASE,8CAA8CA,CACrDC,kBAAkB,EAClBC,yBAAyB,EACzB;EACA,OAAOpB,IAAI,CAACmB,kBAAkB,EAAE,SAASE,wBAAwBA,CAC/DC,iBAAiB,EACjB;IACA,IAAIC,UAAU,GAAGD,iBAAiB,CAACd,UAAU,IAAI,EAAE;IACnD,OAAOe,UAAU,CAACC,OAAO,CAACJ,yBAAyB,CAAC,GAAG,CAAC,CAAC;EAC3D,CAAC,CAAC;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASK,aAAaA,CAACC,KAAK,EAAEC,OAAO,EAAEC,OAAO,EAAE;EAC9C,IAAIC,eAAe,GAAGF,OAAO,CAAC,CAAC,CAAC;EAEhC,IAAI,CAACG,WAAW,GAAGH,OAAO;EAE1B,IAAII,IAAI,GAAG,IAAI;;EAEf;EACAC,MAAM,CAACC,IAAI,CAACJ,eAAe,CAAC,CAACnB,OAAO,CAAC,UAASM,GAAG,EAAE;IACjDe,IAAI,CAACf,GAAG,CAAC,GAAGa,eAAe,CAACb,GAAG,CAAC;EAClC,CAAC,CAAC;;EAEF;EACAgB,MAAM,CAACC,IAAI,CAACL,OAAO,IAAI,CAAC,CAAC,CAAC,CAAClB,OAAO,CAAC,UAASM,GAAG,EAAE;IAC/Ce,IAAI,CAACf,GAAG,CAAC,GAAGY,OAAO,CAACZ,GAAG,CAAC;EAC1B,CAAC,CAAC;;EAEF;AACF;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;EACE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;EAEE;AACF;AACA;AACA;EACE,IAAI,CAACkB,gBAAgB,GAAGP,OAAO,CAACQ,MAAM,CAAC,UAASC,GAAG,EAAEC,MAAM,EAAE;IAC3D,OAAOA,MAAM,CAACH,gBAAgB,KAAKI,SAAS,GACxCF,GAAG,GACHA,GAAG,GAAGC,MAAM,CAACH,gBAAgB;EACnC,CAAC,EAAE,CAAC,CAAC;;EAEL;AACF;AACA;AACA;EACE,IAAI,CAACK,iBAAiB,GAAG,EAAE;EAC3B;AACF;AACA;AACA;EACE,IAAI,CAACpB,kBAAkB,GAAGO,KAAK,CAACP,kBAAkB,CAACqB,GAAG,CAAC,SAASC,cAAcA,CAAA,EAAG;IAC/E,OAAO,EAAE;EACX,CAAC,CAAC;EACF;AACF;AACA;AACA;EACE,IA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"},"metadata":{},"sourceType":"script","externalDependencies":[]}